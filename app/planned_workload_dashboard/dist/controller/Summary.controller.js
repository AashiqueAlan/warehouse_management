sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return e.extend("plannedworkloaddashboard.controller.Summary",{onInit(){this._oRouter=this.getOwnerComponent().getRouter();this._oRouter.getRoute("summaryView").attachPatternMatched(this._onRouteMatched,this);this.getView().setModel(new t({reportTypeLabel:"",reportType:"",inboundData:[],outboundData:[],inboundData24:[],outboundData24:[],inboundData48:[],outboundData48:[],showBothPanels:false,showInboundOnly:false,showOutboundOnly:false,showDualTimeWindows:false,showDualTimeWindowsInboundOnly:false,showDualTimeWindowsOutboundOnly:false,dualShowOutbound:false,dualShowInbound:false,selectedHours:{hours24:false,hours48:false}}),"viewModel")},_onRouteMatched(){const e=this.getOwnerComponent().getModel("navigation").getProperty("/navigationData")||{};console.log("Incoming data for SummaryView",e);this._updateViewData(e)},_updateViewData(e){const t=this.getView().getModel("viewModel");t.setProperty("/showDualTimeWindows",false);t.setProperty("/showDualTimeWindowsInboundOnly",false);t.setProperty("/showDualTimeWindowsOutboundOnly",false);t.setProperty("/showBothPanels",false);t.setProperty("/showInboundOnly",false);t.setProperty("/showOutboundOnly",false);t.setProperty("/reportTypeLabel",e.reportTypeLabel);t.setProperty("/reportType",e.reportType);t.setProperty("/selectedHours",e.selectedHours||{hours24:false,hours48:false});const o=e.selectedHours&&e.selectedHours.hours24&&e.selectedHours.hours48;if(o){const o=e.inboundData?e.inboundData.filter(e=>e.Hours==="24"):[];const r=e.inboundData?e.inboundData.filter(e=>e.Hours==="48"):[];const n=e.outboundData?e.outboundData.filter(e=>e.Hours==="24"):[];const u=e.outboundData?e.outboundData.filter(e=>e.Hours==="48"):[];console.log("inbound24Data",o);console.log("inbound48Data",r);console.log("outbound24Data",n);console.log("outbound48Data",u);t.setProperty("/inboundData24",this._transformInboundTreeData(o));t.setProperty("/inboundData48",this._transformInboundTreeData(r));t.setProperty("/outboundData24",this._transformOutboundTreeData(n));t.setProperty("/outboundData48",this._transformOutboundTreeData(u));if(e.reportType==="IN"){t.setProperty("/showDualTimeWindowsInboundOnly",true)}else if(e.reportType==="OUT"){t.setProperty("/showDualTimeWindowsOutboundOnly",true)}else if(e.reportType==="BOTH"){t.setProperty("/showDualTimeWindows",true);t.setProperty("/dualShowOutbound",true);t.setProperty("/dualShowInbound",true)}}else{t.setProperty("/showBothPanels",e.reportType==="BOTH");t.setProperty("/showInboundOnly",e.reportType==="IN");t.setProperty("/showOutboundOnly",e.reportType==="OUT");const o=this._transformInboundTreeData(e.inboundData||[]);t.setProperty("/inboundData",o);const r=this._transformOutboundTreeData(e.outboundData||[]);t.setProperty("/outboundData",r)}},_transformOutboundTreeData(e){const t=[...e].sort((e,t)=>Number(e.SequenceNumber)-Number(t.SequenceNumber));const o=[];const r=[];const n=[];t.forEach(e=>{const t=Number(e.SequenceNumber);const u=this._formatDisplayValue(e.AvailableWorkinQueue);if(t===7||t===8){r.push({QueueDescription:e.QueueDescription,AvailableWorkinQueue:u,isParent:false,children:[]});return}if(t===9||t===10){n.push({QueueDescription:e.QueueDescription,AvailableWorkinQueue:u,isParent:false,children:[]});return}o.push({SequenceNumber:t,QueueDescription:e.QueueDescription,AvailableWorkinQueue:u,isParent:false,children:[]})});const u=o.findIndex(e=>e.SequenceNumber>6);const s=u===-1?o.length:u;if(r.length){o.splice(s,0,{QueueDescription:"Scheduled Loads",AvailableWorkinQueue:r.reduce((e,t)=>e+Number(t.AvailableWorkinQueue),0).toString(),isParent:true,children:r})}if(n.length){o.splice(s+1,0,{QueueDescription:"Missed Loads",AvailableWorkinQueue:n.reduce((e,t)=>e+Number(t.AvailableWorkinQueue),0).toString(),isParent:true,children:n})}return o},_transformInboundTreeData(e){const t=[...e].sort((e,t)=>Number(e.SequenceNumber)-Number(t.SequenceNumber));const o=[];const r=[];const n=[];const u=e=>this._parseValue(e.AvailableWorkinQueue);t.forEach(e=>{const t=Number(e.SequenceNumber);if(t===1||t===2||t===3){r.push({QueueDescription:e.QueueDescription,AvailableWorkinQueue:u(e).toString(),isParent:false,children:[]});return}if(t===4||t===5){n.push({QueueDescription:e.QueueDescription,AvailableWorkinQueue:u(e).toString(),isParent:false,children:[]});return}o.push({QueueDescription:e.QueueDescription,AvailableWorkinQueue:u(e).toString(),isParent:true,children:[]})});let s=0;if(r.length){o.splice(s,0,{QueueDescription:"Total Inbound Trucks",AvailableWorkinQueue:r.reduce((e,t)=>e+Number(t.AvailableWorkinQueue),0).toString(),isParent:true,children:r});s++}if(n.length){o.splice(s,0,{QueueDescription:"Putaway Pallets",AvailableWorkinQueue:n.reduce((e,t)=>e+Number(t.AvailableWorkinQueue),0).toString(),isParent:true,children:n})}return o},_parseValue(e){if(!e)return 0;const t=parseInt(e,10);return isNaN(t)?0:t},_formatDisplayValue(e){if(e===""||e===null||e===undefined){return"0"}const t=String(e).trim();if(/^\d{4}-\d{2}-\d{2}$/.test(t)){return t}if(/^\d{2}:\d{2}:\d{2}$/.test(t)){return t}if(/^-?\d+\.\d+$/.test(t)){return Math.trunc(Number(t)).toString()}if(/^-?\d+$/.test(t)){return t}return t},onRowsUpdated:function(e){const t=e.getSource();const o=t.getRows();const r=t.getModel("viewModel");o.forEach(function(e){const t=e.getBindingContext("viewModel");if(!t){return}const o=r.getProperty(t.getPath());if(o&&o.isParent===true){e.addStyleClass("parentRowBold");e.removeStyleClass("childRowNormal")}else{e.removeStyleClass("parentRowBold");e.addStyleClass("childRowNormal")}})},onNavBack(){this._oRouter.navTo("RouteMain")}})});
//# sourceMappingURL=Summary.controller.js.map