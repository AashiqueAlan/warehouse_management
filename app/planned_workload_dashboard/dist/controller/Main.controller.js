sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","sap/m/VariantItem"],function(e,t,r,o,s,a,i){"use strict";return e.extend("plannedworkloaddashboard.controller.Main",{onInit(){const e=new t({selectedWarehouse:"",selectedQueues:[],waveDate:null,waveTime:null,pickDate:null,pickTime:null,hours48:true,hours24:false,reportType_IN:false,reportType_OUT:false,reportType:"BOTH",viewType:"SUMMARY",show24Hours:true,showResults:false,shiftData:[],isLoading:false,directionLabel:"Queue"});this.getView().setModel(e,"viewModel");this._oVM=this.byId("variantManagement");this._oRouter=this.getOwnerComponent().getRouter();this._loadSavedVariants();this._applyDefaultVariant();this.getCurrentDateTime()},getCurrentDateTime(){const e=this.getView().getModel("viewModel");const t=new Date;const r=new Date;const o=r.toISOString().slice(0,10);const s=r.toTimeString().slice(0,8);const a=t.toTimeString().slice(0,8);t.setDate(t.getDate()+2);const i=t.toISOString().slice(0,10);e.setProperty("/waveTime",s);e.setProperty("/pickTime",a);e.setProperty("/waveDate",o);e.setProperty("/pickDate",i)},onReportTypeSelect(e){const t=e.getSource().getSelectedIndex();const r=this.getView().getModel("viewModel");const o=t===0?"IN":t===1?"OUT":"BOTH";r.setProperty("/reportType",o)},onViewTypeSelect(e){const t=e.getSource().getSelectedIndex();const r=this.getView().getModel("viewModel");const o=r.getProperty("/waveDate");const s=t===0?"SUMMARY":t===1?"SHIFT":"LABOR";r.setProperty("/viewType",s);this._applyViewTypeRules(s)},onWaveDateDatePickerChange(){const e=this.getView().getModel("viewModel");const t=e.getProperty("/waveDate");const r=e.getProperty("/hours48");const o=e.getProperty("/hours24");const s=r?2:o?1:0;const a=new Date(t);a.setDate(a.getDate()+s);const i=a.toISOString().slice(0,10);e.setProperty("/pickDate",i)},onWaveTimeTimePickerChange(){const e=this.getView().getModel("viewModel");const t=e.getProperty("/waveTime");e.setProperty("/pickTime",t)},onHoursCheckboxSelect(e){const t=this.getView().getModel("viewModel");const r=t.getProperty("/waveDate");const o=t.getProperty("/hours48");const s=t.getProperty("/hours24");if(!o&&!s){const r=e.getSource();const o=r.getText();if(o==="48 Hours"){t.setProperty("/hours48",true)}else if(o==="24 Hours"){t.setProperty("/hours24",true)}return}const a=new Date(r);const i=o?2:s?1:0;a.setDate(a.getDate()+i);const n=a.toISOString().slice(0,10);t.setProperty("/pickDate",n);this._oVM.setModified(true)},_loadSavedVariants:function(){const e=localStorage.getItem("plannedWorkloadVariants");if(e){try{const t=JSON.parse(e);t.forEach(e=>{const t=new i({key:e.key,title:e.title,author:e.author||"User",favorite:true,visible:true,executeOnSelect:false,rename:true,changeable:true,remove:true});this._oVM.addItem(t)})}catch(e){console.error("Failed to parse variants",e)}}},_applyDefaultVariant:function(){const e=localStorage.getItem("defaultPlannedWorkloadVariant");if(e){this._oVM.setDefaultKey(e);this._oVM.setSelectedKey(e);this._applyVariant(e)}},_applyVariant:function(e){if(e==="standard"){this.onClear();return}const t=localStorage.getItem("plannedWorkloadVariants");if(t){try{const r=JSON.parse(t);const o=r.find(t=>t.key===e);if(o&&o.state){const e=o.state;const t=this.getView().getModel("viewModel");t.setProperty("/selectedWarehouse",e.selectedWarehouse||"");t.setProperty("/selectedQueues",e.selectedQueues||[]);t.setProperty("/waveDate",e.waveDate||null);t.setProperty("/waveTime",e.waveTime||null);t.setProperty("/pickDate",e.pickDate||null);t.setProperty("/pickTime",e.pickTime||null);t.setProperty("/hours48",e.hours48!==undefined?e.hours48:true);t.setProperty("/hours24",e.hours24||false);t.setProperty("/reportType_IN",e.reportType_IN||false);t.setProperty("/reportType_OUT",e.reportType_OUT||false);t.setProperty("/reportType",e.reportType||"BOTH");t.setProperty("/viewType",e.viewType||"SHIFT");this._applyViewTypeRules(t.getProperty("/viewType"));const r=this.byId("viewTypeGroup");if(r){r.setSelectedIndex(e.viewType==="SUMMARY"?0:e.viewType==="SHIFT"?1:2)}a.show("Variant '"+o.title+"' applied")}}catch(e){console.error("Failed to apply variant",e)}}},_saveVariantsToStorage:function(){const e=this._oVM.getItems();const t=[];e.forEach(e=>{const r=e.getKey();if(r==="standard"){return}const o=localStorage.getItem("plannedWorkloadVariants");let s=null;if(o){try{const e=JSON.parse(o);const t=e.find(e=>e.key===r);if(t){s=t.state}}catch(e){console.error("Error parsing stored variants",e)}}t.push({key:r,title:e.getTitle(),author:e.getAuthor(),state:s})});localStorage.setItem("plannedWorkloadVariants",JSON.stringify(t))},_applyViewTypeRules(e){const t=this.getView().getModel("viewModel");if(e==="SHIFT"){t.setProperty("/hours48",true);t.setProperty("/hours24",false);t.setProperty("/show24Hours",false);t.setProperty("/showHoursSelection",false);const e=t.getProperty("/waveDate");if(e){const r=new Date(e);r.setDate(r.getDate()+2);t.setProperty("/pickDate",r.toISOString().slice(0,10))}}else{t.setProperty("/show24Hours",true);t.setProperty("/showHoursSelection",true)}},_checkCurrentVariant:function(){const e=this._oVM.getSelectedKey();const t=this._oVM.getItemByKey(e);if(!t){const e=this._oVM.getStandardVariantKey();if(e){this._oVM.setSelectedKey(e)}}},_updateItems:function(e){if(e.deleted){e.deleted.forEach(e=>{const t=this._oVM.getItemByKey(e);if(t){this._oVM.removeItem(t);t.destroy()}})}if(e.renamed){e.renamed.forEach(e=>{const t=this._oVM.getItemByKey(e.key);if(t){t.setTitle(e.name)}})}if(e.hasOwnProperty("def")){this._oVM.setDefaultKey(e.def);localStorage.setItem("defaultPlannedWorkloadVariant",e.def)}this._checkCurrentVariant()},_createNewItem:function(e){const t="variant_"+Date.now();const r=this.getView().getModel("viewModel");const o={selectedWarehouse:r.getProperty("/selectedWarehouse"),selectedQueues:r.getProperty("/selectedQueues"),waveDate:r.getProperty("/waveDate"),waveTime:r.getProperty("/waveTime"),pickDate:r.getProperty("/pickDate"),pickTime:r.getProperty("/pickTime"),hours48:r.getProperty("/hours48"),hours24:r.getProperty("/hours24"),reportType_IN:r.getProperty("/reportType_IN"),reportType_OUT:r.getProperty("/reportType_OUT"),reportType:r.getProperty("/reportType"),viewType:r.getProperty("/viewType")};const s=new i({key:t,title:e.name,executeOnSelect:false,author:"User",favorite:true,changeable:true,remove:true,rename:true});if(e.def){this._oVM.setDefaultKey(t);localStorage.setItem("defaultPlannedWorkloadVariant",t)}this._oVM.addItem(s);const n=localStorage.getItem("plannedWorkloadVariants");let l=[];if(n){try{l=JSON.parse(n)}catch(e){console.error("Failed to parse variants",e)}}l.push({key:t,title:e.name,author:"User",state:o});localStorage.setItem("plannedWorkloadVariants",JSON.stringify(l));a.show("Variant '"+e.name+"' saved successfully");this._oVM.setModified(false)},onVariantSelect:function(e){const t=e.getParameter("key");this._applyVariant(t);this._oVM.setModified(false)},onVariantSave:function(e){const t=e.getParameters();if(t.overwrite){const e=this._oVM.getItemByKey(t.key);const r=this.getView().getModel("viewModel");const o={selectedWarehouse:r.getProperty("/selectedWarehouse"),selectedQueues:r.getProperty("/selectedQueues"),waveDate:r.getProperty("/waveDate"),waveTime:r.getProperty("/waveTime"),pickDate:r.getProperty("/pickDate"),pickTime:r.getProperty("/pickTime"),hours48:r.getProperty("/hours48"),hours24:r.getProperty("/hours24"),reportType_IN:r.getProperty("/reportType_IN"),reportType_OUT:r.getProperty("/reportType_OUT"),reportType:r.getProperty("/reportType"),viewType:r.getProperty("/viewType")};const s=localStorage.getItem("plannedWorkloadVariants");let i=[];if(s){try{i=JSON.parse(s)}catch(e){console.error("Failed to parse variants",e)}}const n=i.find(e=>e.key===t.key);if(n){n.state=o;n.title=t.name}localStorage.setItem("plannedWorkloadVariants",JSON.stringify(i));if(t.def){this._oVM.setDefaultKey(t.key);localStorage.setItem("defaultPlannedWorkloadVariant",t.key)}a.show("Variant '"+e.getTitle()+"' updated");this._oVM.setModified(false)}else{this._createNewItem(t)}},onVariantManage:function(e){const t=e.getParameters();this._updateItems(t);this._saveVariantsToStorage();a.show("Variants updated successfully")},onGenerateReport(){const e=this.getView().getModel("viewModel");const t=e.getProperty("/selectedWarehouse");const r=e.getProperty("/selectedQueues");const o=e.getProperty("/reportType");const i=e.getProperty("/viewType");const n=e.getProperty("/hours48");const l=e.getProperty("/hours24");const p=e.getProperty("/waveDate");const c=e.getProperty("/pickDate");const u=new Date(p);const y=new Date(c);console.log(isNaN(u.getTime()));if(!t){s.error("Please select a Warehouse");return}if(!c||!p){s.error("Please select any date to continue");return}if(isNaN(u.getTime())||isNaN(y.getTime())){s.error("Invalid Date Format");return}if(y<u){s.error("Wave Date cannot be greater than Pick Date");return}let d="Queue";if(o==="IN"){d="Inbound Queue"}else if(o==="OUT"){d="Outbound Queue"}e.setProperty("/directionLabel",d);e.setProperty("/isLoading",true);e.setProperty("/showResults",false);const g={WarehouseNumber:t,ReportType:o,ViewType:i,FortyEightHrs:n?"X":"",TwentyFourHrs:l?"X":"",WavedDate:e.getProperty("/waveDate"),WavedTime:e.getProperty("/waveTime"),PickCompleteDate:e.getProperty("/pickDate"),PickCompleteTime:e.getProperty("/pickTime"),Queues:r.length?r.map(e=>({Queue:e})):[]};const h=this.getView().getModel();this._fetchReportData(h,g).then(p=>{e.setProperty("/isLoading",false);const c=p.NavWhseQueueInbound||[];const u=p.NavWhseQueueOutbound||[];if(c.length===0&&u.length===0){s.information("No data found for selected criteria");return}const y={warehouseNumber:t,reportType:o,reportTypeLabel:this._getReportTypeLabel(o),waveDateTime:this._formatDateTime(e.getProperty("/waveDate"),e.getProperty("/waveTime")),pickCompleteDateTime:this._formatDateTime(e.getProperty("/pickDate"),e.getProperty("/pickTime")),inboundData:c,outboundData:u,selectedQueues:r,viewType:i,selectedHours:{hours48:n,hours24:l}};const d=this.getOwnerComponent().getModel("navigation");d.setProperty("/navigationData",y);let g="shiftDetails";if(i==="SUMMARY"){g="summaryView"}else if(i==="LABOR"){g="laborView"}else if(i==="SHIFT"){g="shiftDetails"}this._oRouter.navTo(g);a.show("Report generated successfully")}).catch(t=>{e.setProperty("/isLoading",false);s.error("Failed to generate report");console.error(t)})},_fetchReportData(e,t){return new Promise((r,o)=>{const s=e.bindContext("/getShiftViewData(...)");s.setParameter("WarehouseNumber",t.WarehouseNumber);s.setParameter("ReportType",t.ReportType);s.setParameter("ViewType",t.ViewType);if(t.FortyEightHrs){s.setParameter("FortyEightHrs",t.FortyEightHrs)}if(t.TwentyFourHrs){s.setParameter("TwentyFourHrs",t.TwentyFourHrs)}if(t.WavedDate){s.setParameter("WavedDate",t.WavedDate)}if(t.WavedTime){s.setParameter("WavedTime",t.WavedTime)}if(t.PickCompleteDate){s.setParameter("PickCompleteDate",t.PickCompleteDate)}if(t.PickCompleteTime){s.setParameter("PickCompleteTime",t.PickCompleteTime)}if(t.Queues?.length){s.setParameter("Queues",t.Queues)}s.execute().then(()=>{const e=s.getBoundContext().getObject();console.log("Backend Response",e);r(e)}).catch(e=>{o(e)})})},formatDeltaState:function(e){if(e===null||e===undefined){return"None"}return e<0?"Error":"Success"},onWarehouseChange:function(e){const t=this.getView().getModel("viewModel");const s=e.getSource().getSelectedKey();t.setProperty("/selectedWarehouse",s);t.setProperty("/selectedQueues",[]);t.setProperty("/showResults",false);t.setProperty("/shiftData",[]);this._oVM.setModified(true);const a=this.byId("queueMultiSelect");if(!a){return}const i=a.getBinding("items");if(!s){i.filter([]);return}const n=new r("Lgnum",o.EQ,s);i.filter([n])},onQueueMultiSelectSelectionChange:function(e){const t=this.getView().getModel("viewModel");const r=e.getSource().getSelectedKeys();t.setProperty("/selectedQueues",r);this._oVM.setModified(true)},onClear(){const e=this.getView().getModel("viewModel");e.setProperty("/selectedWarehouse","");e.setProperty("/selectedQueues",[]);e.setProperty("/waveDate",null);e.setProperty("/waveTime",null);e.setProperty("/pickDate",null);e.setProperty("/pickTime",null);e.setProperty("/reportType","BOTH");e.setProperty("/reportType_IN",false);e.setProperty("/reportType_OUT",false);e.setProperty("/viewType","SUMMARY");e.setProperty("/hours48",true);e.setProperty("/hours24",false);e.setProperty("/showResults",false);e.setProperty("/shiftData",[]);e.setProperty("/isLoading",false);e.setProperty("/directionLabel","Queue");const t=this.byId("queueMultiSelect");if(t){const e=t.getBinding("items");if(e){e.filter([])}}a.show("Selection cleared")},_getReportTypeLabel(e){switch(e){case"IN":return"Inbound";case"OUT":return"Outbound";case"BOTH":return"Both Inbound & Outbound";default:return"Unknown"}},_formatDateTime(e,t){if(!e&&!t){return""}return`${e||""} ${t||""}`.trim()}})});
//# sourceMappingURL=Main.controller.js.map