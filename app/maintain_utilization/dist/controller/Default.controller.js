sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/VariantItem"],(e,t,a,o)=>{"use strict";return e.extend("maintainutilization.controller.Default",{onInit:function(){const e=new t({warehouses:[],selectedWarehouse:null,warehouseCount:0});this.getView().setModel(e,"view");this._loadWarehouses();this._oVM=this.byId("variantManagement");this._loadSavedVariants();this._applyDefaultVariant()},_loadSavedVariants:function(){const e=localStorage.getItem("utilizationWarehouseVariants");if(e){try{const t=JSON.parse(e);t.forEach(e=>{const t=new o({key:e.key,title:e.title,author:e.author||"User",favorite:true,visible:true,executeOnSelect:false,rename:true,changeable:true,remove:true});this._oVM.addItem(t)})}catch(e){console.error("Failed to parse variants",e)}}},_applyDefaultVariant:function(){const e=localStorage.getItem("defaultUtilizationWarehouseVariant");if(e){this._oVM.setDefaultKey(e);this._oVM.setSelectedKey(e);this._applyVariant(e)}},_applyVariant:function(e){if(e==="standard"){this.getView().getModel("view").setProperty("/selectedWarehouse",null);return}const t=localStorage.getItem("utilizationWarehouseVariants");if(t){try{const o=JSON.parse(t);const s=o.find(t=>t.key===e);if(s&&s.warehouse){this.getView().getModel("view").setProperty("/selectedWarehouse",s.warehouse);this.byId("warehouseInput")?.setSelectedKey(s.warehouse);a.show("Variant '"+s.title+"' applied")}}catch(e){console.error("Failed to apply variant",e)}}},_saveVariantsToStorage:function(){const e=this._oVM.getItems();const t=[];e.forEach(e=>{const a=e.getKey();if(a==="standard"){return}const o=localStorage.getItem("utilizationWarehouseVariants");let s=null;if(o){try{const e=JSON.parse(o);const t=e.find(e=>e.key===a);if(t){s=t.warehouse}}catch(e){console.error("Error parsing stored variants",e)}}t.push({key:a,title:e.getTitle(),author:e.getAuthor(),warehouse:s})});localStorage.setItem("utilizationWarehouseVariants",JSON.stringify(t))},_checkCurrentVariant:function(){const e=this._oVM.getSelectedKey();const t=this._oVM.getItemByKey(e);if(!t){const e=this._oVM.getStandardVariantKey();if(e){this._oVM.setSelectedKey(e)}}},_updateItems:function(e){if(e.deleted){e.deleted.forEach(e=>{const t=this._oVM.getItemByKey(e);if(t){this._oVM.removeItem(t);t.destroy()}})}if(e.renamed){e.renamed.forEach(e=>{const t=this._oVM.getItemByKey(e.key);if(t){t.setTitle(e.name)}})}if(e.hasOwnProperty("def")){this._oVM.setDefaultKey(e.def);localStorage.setItem("defaultUtilizationWarehouseVariant",e.def)}this._checkCurrentVariant()},_createNewItem:function(e){const t="variant_"+Date.now();const s=this.getView().getModel("view").getProperty("/selectedWarehouse");if(!s){a.show("Please select a warehouse before saving variant");return}const i=new o({key:t,title:e.name,executeOnSelect:false,author:"User",favorite:true,changeable:true,remove:true,rename:true});if(e.def){this._oVM.setDefaultKey(t);localStorage.setItem("defaultUtilizationWarehouseVariant",t)}this._oVM.addItem(i);const r=localStorage.getItem("utilizationWarehouseVariants");let n=[];if(r){try{n=JSON.parse(r)}catch(e){console.error("Failed to parse variants",e)}}n.push({key:t,title:e.name,author:"User",warehouse:s});localStorage.setItem("utilizationWarehouseVariants",JSON.stringify(n));a.show("Variant '"+e.name+"' saved successfully");this._oVM.setModified(false)},onVariantSelect:function(e){const t=e.getParameter("key");this._applyVariant(t);this._oVM.setModified(false)},onVariantSave:function(e){const t=e.getParameters();if(t.overwrite){const e=this._oVM.getItemByKey(t.key);const o=this.getView().getModel("view").getProperty("/selectedWarehouse");if(!o){a.show("Please select a warehouse before saving variant");return}const s=localStorage.getItem("utilizationWarehouseVariants");let i=[];if(s){try{i=JSON.parse(s)}catch(e){console.error("Failed to parse variants",e)}}const r=i.find(e=>e.key===t.key);if(r){r.warehouse=o;r.title=t.name}localStorage.setItem("utilizationWarehouseVariants",JSON.stringify(i));if(t.def){this._oVM.setDefaultKey(t.key);localStorage.setItem("defaultUtilizationWarehouseVariant",t.key)}a.show("Variant '"+e.getTitle()+"' updated");this._oVM.setModified(false)}else{this._createNewItem(t)}},onVariantManage:function(e){const t=e.getParameters();this._updateItems(t);this._saveVariantsToStorage();a.show("Variants updated successfully")},_loadWarehouses:function(){const e=this.getOwnerComponent().getModel();const t=this.getView().getModel("view");const o=e.bindList("/Warehouses");o.requestContexts(0,Infinity).then(function(e){const a=e.map(e=>e.getObject());t.setProperty("/warehouses",a);t.setProperty("/warehouseCount",a.length)}).catch(function(e){console.error("Failed to load Warehouses",e);a.show("Failed to load warehouses")})},onWarehouseSelected:function(e){const t=e.getParameter("selectedItem");this.getView().getModel("view").setProperty("/selectedWarehouse",t?t.getKey():null);this._oVM.setModified(true)},onContinue:function(){const e=this.getView().getModel("view").getProperty("/selectedWarehouse");if(!e){a.show("Please select a warehouse");return}sessionStorage.setItem("selectedWarehouse",e);this.getOwnerComponent().getRouter().navTo("Main",{lgnum:e})}})});
//# sourceMappingURL=Default.controller.js.map